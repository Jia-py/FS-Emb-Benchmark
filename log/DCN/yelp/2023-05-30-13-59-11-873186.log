[2023-05-30 13:59:11] INFO Log saved in /root/code/FS-Emb-Benchmark/DCN/yelp/2023-05-30-13-59-11-873186.log.
[2023-05-30 13:59:12] INFO Load dataset from cache.
[2023-05-30 13:59:38] INFO 
Dataset Info: 

==============================================================================================================================
item information: 
field         business_id   business_name city          state         postal_code   categories    
type          token         token         token         token         token         token_seq     
##            112395        83408         1181          18            2853          103732        
==============================================================================================================================
user information: 
field         user_id       user_name     
type          token         token         
##            277632        31148         
==============================================================================================================================
interaction information: 
field         review_id     user_id       business_id   stars         date          
type          token         token         token         float         float         
##            4250484       277632        112395        -             -             
==============================================================================================================================
Total Interactions: 4045641
Sparsity: 0.999870
==============================================================================================================================

[2023-05-30 13:59:38] INFO 
Model Config: 

data:
	binarized_rating_thres=3.0
	fm_eval=False
	neg_count=0
	sampler=None
	shuffle=True
	split_mode=user_entry
	split_ratio=[0.8, 0.1, 0.1]
	fmeval=True
	low_rating_thres=0.0
eval:
	batch_size=128
	cutoff=[5, 10, 20]
	val_metrics=['auc', 'logloss']
	val_n_epoch=1
	test_metrics=['auc', 'logloss']
	topk=100
	save_path=./saved/
fs:
	name=optFS
	retrain=True
	retrain_prepare=True
	optimization=Normal
	retrain_reinitialize=False
	before_train_prepare=False
	reinitialize=param
	class=<class 'recstudio.model.feature_selection.optfs.optFS'>
model:
	embed_dim=16
	item_bias=False
	mlp_layer=[128, 128, 128]
	activation=relu
	num_layers=6
	dropout=0.2
	batch_norm=True
train:
	accelerator=gpu
	ann=None
	batch_size=512
	early_stop_mode=max
	early_stop_patience=5
	epochs=20
	gpu=1
	grad_clip_norm=None
	init_method=xavier_normal
	item_batch_size=1024
	learner=adam
	learning_rate=0.01
	num_threads=10
	sampling_method=none
	sampler=uniform
	negative_count=0
	excluding_hist=False
	scheduler=None
	seed=None
	weight_decay=0.0
	tensorboard_path=None
[2023-05-30 13:59:38] INFO GPU id [0] are selected.
[2023-05-30 13:59:38] WARNING No retriever is used, topk metrics is not supported.
[2023-05-30 13:59:45] INFO save_dir:./saved/
[2023-05-30 13:59:45] INFO DCN(
  (loss_fn): BCEWithLogitLoss()
  (feature_selection_layer): optFS(
    (gate): ParameterDict(
        (business_id): Parameter containing: [torch.cuda.FloatTensor of size 112395x1 (GPU 0)]
        (business_name): Parameter containing: [torch.cuda.FloatTensor of size 83408x1 (GPU 0)]
        (categories): Parameter containing: [torch.cuda.FloatTensor of size 103732x1 (GPU 0)]
        (city): Parameter containing: [torch.cuda.FloatTensor of size 1181x1 (GPU 0)]
        (postal_code): Parameter containing: [torch.cuda.FloatTensor of size 2853x1 (GPU 0)]
        (review_id): Parameter containing: [torch.cuda.FloatTensor of size 4250484x1 (GPU 0)]
        (state): Parameter containing: [torch.cuda.FloatTensor of size 18x1 (GPU 0)]
        (user_id): Parameter containing: [torch.cuda.FloatTensor of size 277632x1 (GPU 0)]
        (user_name): Parameter containing: [torch.cuda.FloatTensor of size 31148x1 (GPU 0)]
    )
  )
  (embedding): Embeddings(
    num_features=10, embed_dim=16, reduction=mean, share_dense_embedding=True
    (embeddings): ModuleDict(
      (user_id): Embedding(277632, 16, padding_idx=0)
      (business_name): Embedding(83408, 16, padding_idx=0)
      (review_id): Embedding(4250484, 16, padding_idx=0)
      (user_name): Embedding(31148, 16, padding_idx=0)
      (postal_code): Embedding(2853, 16, padding_idx=0)
      (business_id): Embedding(112395, 16, padding_idx=0)
      (state): Embedding(18, 16, padding_idx=0)
      (city): Embedding(1181, 16, padding_idx=0)
      (categories): Embedding(103732, 16, padding_idx=0)
      (date): DenseEmbedding(
        embedding_dim=16, bias=False, batch_norm=True
        (batch_norm_layer): BatchNorm1d(1, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
        (weight): Linear(in_features=1, out_features=16, bias=False)
      )
    )
    (seq_pooling_layer): SeqPoolingLayer(pooling_type=mean, keepdim=False)
  )
  (cross_net): CrossNetwork(
    embed_dim=160, num_layers=6
    (cross): ModuleList(
      (0): CrossInteraction()
      (1): CrossInteraction()
      (2): CrossInteraction()
      (3): CrossInteraction()
      (4): CrossInteraction()
      (5): CrossInteraction()
    )
  )
  (mlp): MLPModule(
    (model): Sequential(
      (0): Dropout(p=0.2, inplace=False)
      (1): Linear(in_features=160, out_features=128, bias=True)
      (2): BatchNorm1d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (3): ReLU()
      (4): Dropout(p=0.2, inplace=False)
      (5): Linear(in_features=128, out_features=128, bias=True)
      (6): BatchNorm1d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (7): ReLU()
      (8): Dropout(p=0.2, inplace=False)
      (9): Linear(in_features=128, out_features=128, bias=True)
      (10): BatchNorm1d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (11): ReLU()
    )
  )
  (fc): Linear(in_features=288, out_features=1, bias=True)
)
[2023-05-30 13:59:45] INFO GPU id [0] are selected.
[2023-05-30 15:10:07] INFO Training: Epoch=  0 [logloss=0.3944 auc=0.7918 train_loss_0=0.4032]
[2023-05-30 15:10:07] INFO Train time: 3928.48211s. Valid time: 293.25559s. GPU RAM: 2.15/9.77 GB
[2023-05-30 15:10:07] INFO auc improved. Best value: 0.7918
[2023-05-30 15:10:08] INFO Best model checkpoint saved in ./saved/DCN/yelp/2023-05-30-13-59-11-873186.ckpt.
[2023-05-30 16:25:29] INFO Training: Epoch=  1 [logloss=0.4533 auc=0.7494 train_loss_0=0.2239]
[2023-05-30 16:25:29] INFO Train time: 4221.24687s. Valid time: 299.65696s. GPU RAM: 2.41/9.77 GB
[2023-05-30 17:41:01] INFO Training: Epoch=  2 [logloss=0.4408 auc=0.7784 train_loss_0=0.1780]
[2023-05-30 17:41:01] INFO Train time: 4225.90842s. Valid time: 306.33169s. GPU RAM: 2.41/9.77 GB
[2023-05-30 18:55:47] INFO Training: Epoch=  3 [logloss=0.4867 auc=0.7669 train_loss_0=0.2139]
[2023-05-30 18:55:47] INFO Train time: 4218.91940s. Valid time: 267.41136s. GPU RAM: 2.41/9.77 GB
[2023-05-30 20:08:19] INFO Training: Epoch=  4 [logloss=0.5701 auc=0.7642 train_loss_0=0.3132]
[2023-05-30 20:08:19] INFO Train time: 4083.89649s. Valid time: 267.28580s. GPU RAM: 2.41/9.77 GB
[2023-05-30 21:18:01] INFO Training: Epoch=  5 [logloss=0.5718 auc=0.7704 train_loss_0=0.0553]
[2023-05-30 21:18:01] INFO Train time: 4060.94686s. Valid time: 121.87449s. GPU RAM: 2.41/9.77 GB
[2023-05-30 21:18:01] INFO Early stopped. Since the metric auc haven't been improved for 5 epochs.
[2023-05-30 21:18:01] INFO The best score of auc is 0.7918 on epoch 0
[2023-05-30 21:18:02] INFO Best model checkpoint saved in ./saved/DCN/yelp/2023-05-30-13-59-11-873186.ckpt.
[2023-05-30 21:18:02] INFO retrain model
[2023-05-30 21:18:02] INFO save_dir:./saved/
[2023-05-30 21:58:33] INFO Training: Epoch=  0 [logloss=0.4029 auc=0.7766 train_loss_0=0.4301]
[2023-05-30 21:58:33] INFO Train time: 2347.58003s. Valid time: 82.91073s. GPU RAM: 2.41/9.77 GB
[2023-05-30 21:58:33] INFO auc improved. Best value: 0.7766
[2023-05-30 21:58:34] INFO Best model checkpoint saved in ./saved/DCN/yelp/2023-05-30-13-59-11-873186.ckpt.
[2023-05-30 22:40:15] INFO Training: Epoch=  1 [logloss=0.5604 auc=0.7683 train_loss_0=0.2878]
[2023-05-30 22:40:15] INFO Train time: 2416.58497s. Valid time: 84.06234s. GPU RAM: 2.41/9.77 GB
[2023-05-30 23:21:47] INFO Training: Epoch=  2 [logloss=3.9177 auc=0.7525 train_loss_0=0.3007]
[2023-05-30 23:21:47] INFO Train time: 2409.23963s. Valid time: 82.15744s. GPU RAM: 2.41/9.77 GB
[2023-05-31 00:02:59] INFO Training: Epoch=  3 [logloss=0.6430 auc=0.7675 train_loss_0=0.0763]
[2023-05-31 00:02:59] INFO Train time: 2392.02603s. Valid time: 80.11010s. GPU RAM: 2.41/9.77 GB
[2023-05-31 00:44:26] INFO Training: Epoch=  4 [logloss=1.7889 auc=0.7516 train_loss_0=1.1071]
[2023-05-31 00:44:26] INFO Train time: 2405.38235s. Valid time: 82.03618s. GPU RAM: 2.41/9.77 GB
[2023-05-31 01:26:01] INFO Training: Epoch=  5 [logloss=0.5912 auc=0.7646 train_loss_0=0.0860]
[2023-05-31 01:26:01] INFO Train time: 2414.76487s. Valid time: 80.19096s. GPU RAM: 2.41/9.77 GB
[2023-05-31 01:26:01] INFO Early stopped. Since the metric auc haven't been improved for 5 epochs.
[2023-05-31 01:26:01] INFO The best score of auc is 0.7766 on epoch 0
[2023-05-31 01:26:02] INFO Best model checkpoint saved in ./saved/DCN/yelp/2023-05-30-13-59-11-873186.ckpt.
[2023-05-31 01:27:24] INFO Testing:  [logloss=0.4041 auc=0.7752]
